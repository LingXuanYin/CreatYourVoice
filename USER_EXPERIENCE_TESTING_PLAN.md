# CreatYourVoice 用户体验测试和优化计划

## 测试目标

基于用户明确的需求，验证新UI架构是否能够：
1. **正确实现两阶段工作流**：角色声音基底创建 + 语音合成
2. **提供清晰的单栏引导**：用户能够顺利完成整个流程
3. **权重计算机械化**：用户输入任意数字，系统正确归一化
4. **支持三种创建模式**：从零开始、从现有产物、融合现有产物

## 测试场景设计

### 场景1：从零开始创建角色声音基底

**测试步骤：**
1. 用户进入"创建角色声音基底"Tab
2. 选择"从零开始创建"
3. 选择音频标签（如"少女"）
4. 设置DDSP-SVC参数（音调偏移：+2，声音粗细：-1）
5. 选择3个说话人，输入权重：1000, 4000, 2000
6. 验证系统计算权重：0.143, 0.571, 0.286
7. 生成预览
8. 保存角色声音基底

**预期结果：**
- 界面引导清晰，每步操作明确
- 权重计算正确且实时显示
- 预览音频生成成功
- 保存功能正常

**测试数据：**
```json
{
  "test_case": "从零开始创建",
  "audio_tag": "teen_female",
  "ddsp_params": {
    "pitch_shift": 2.0,
    "voice_thickness": -1.0
  },
  "speaker_weights": {
    "speaker_001": 1000,
    "speaker_002": 4000,
    "speaker_003": 2000
  },
  "expected_normalized": {
    "speaker_001": 0.143,
    "speaker_002": 0.571,
    "speaker_003": 0.286
  }
}
```

### 场景2：从现有产物创建角色声音基底

**测试步骤：**
1. 选择"从现有产物创建"
2. 选择一个历史语音产物
3. 设置现有产物权重：0.6
4. 添加新的音频标签和说话人权重
5. 验证权重融合计算
6. 生成预览并保存

**权重计算验证：**
```python
# 假设现有产物权重：{"speaker_A": 0.4, "speaker_B": 0.6}
# 新权重：{"speaker_C": 1000, "speaker_D": 2000}
# 现有产物权重比例：0.6

# 计算过程：
old_weighted = {"speaker_A": 0.4 * 0.6, "speaker_B": 0.6 * 0.6}
# = {"speaker_A": 0.24, "speaker_B": 0.36}

new_normalized = {"speaker_C": 1000/3000, "speaker_D": 2000/3000}
# = {"speaker_C": 0.333, "speaker_D": 0.667}

new_weighted = {"speaker_C": 0.333 * 0.4, "speaker_D": 0.667 * 0.4}
# = {"speaker_C": 0.133, "speaker_D": 0.267}

final_result = {
  "speaker_A": 0.24,
  "speaker_B": 0.36,
  "speaker_C": 0.133,
  "speaker_D": 0.267
}
# 总和：0.24 + 0.36 + 0.133 + 0.267 = 1.0 ✓
```

### 场景3：融合现有产物

**测试步骤：**
1. 选择"融合现有产物"
2. 选择3个现有产物，输入权重：500, 1500, 1000
3. 验证融合权重计算
4. 生成预览并保存

**测试数据：**
```json
{
  "test_case": "融合现有产物",
  "products": [
    {
      "id": "product_001",
      "weight": 500,
      "speaker_weights": {"spk_A": 0.3, "spk_B": 0.7}
    },
    {
      "id": "product_002",
      "weight": 1500,
      "speaker_weights": {"spk_B": 0.4, "spk_C": 0.6}
    },
    {
      "id": "product_003",
      "weight": 1000,
      "speaker_weights": {"spk_A": 0.5, "spk_D": 0.5}
    }
  ],
  "expected_final_weights": {
    "spk_A": 0.233,
    "spk_B": 0.417,
    "spk_C": 0.3,
    "spk_D": 0.167
  }
}
```

### 场景4：使用音色合成语音

**测试步骤：**
1. 进入"语音合成"Tab
2. 输入文本："你好，我是新创建的音色角色。"
3. 选择已创建的角色声音基底
4. 测试不同情感模式：
   - 普通模式（无情感）
   - 情感描述："开心、活泼"
   - 情感参考音频
   - 高级模式（情感向量）
5. 生成合成音频
6. 保存语音产物

## 响应式测试

### 设备兼容性测试

**测试设备：**
- iPhone SE (375px)
- iPhone 12 (390px)
- iPad (768px)
- iPad Pro (1024px)
- MacBook (1280px)
- 桌面显示器 (1920px)

**测试要点：**
1. **单栏布局保持**：所有设备都使用单栏引导式布局
2. **触摸友好**：移动端按钮和输入框足够大
3. **文字可读性**：所有设备上文字清晰可读
4. **操作便利性**：权重输入在移动端易于操作

### 性能测试

**测试指标：**
- 页面加载时间 < 3秒
- 权重计算响应时间 < 100ms
- 音频预览生成时间 < 10秒
- 内存使用 < 500MB

## 可用性测试

### 用户任务测试

**任务1：创建一个少女音色**
- 目标：用户能在10分钟内完成角色声音基底创建
- 成功标准：无需帮助完成整个流程

**任务2：调整现有音色**
- 目标：用户能理解权重融合概念并成功操作
- 成功标准：正确设置权重比例

**任务3：合成带情感的语音**
- 目标：用户能使用不同情感模式合成语音
- 成功标准：理解各种情感控制方式的区别

### 错误处理测试

**错误场景：**
1. 用户未选择音频标签就尝试预览
2. 用户设置的所有权重都为0
3. 用户上传了错误格式的情感参考音频
4. 网络中断时的处理

**预期行为：**
- 清晰的错误提示信息
- 指导用户如何修正错误
- 不会丢失用户已输入的数据

## 测试工具和方法

### 自动化测试

```python
# 权重计算测试
def test_weight_calculation():
    """测试权重计算的正确性"""
    test_cases = [
        ([1000, 4000, 2000], {"item_0": 0.143, "item_1": 0.571, "item_2": 0.286}),
        ([1, 1, 1], {"item_0": 0.333, "item_1": 0.333, "item_2": 0.333}),
        ([100], {"item_0": 1.0}),
        ([0, 0, 0], {}),
    ]

    for inputs, expected in test_cases:
        result = calculate_normalized_weights(*inputs)
        assert_weights_equal(result, expected, tolerance=0.001)

def test_weight_fusion():
    """测试权重融合计算"""
    old_weights = {"spk_A": 0.4, "spk_B": 0.6}
    old_ratio = 0.6
    new_weights = {"spk_C": 0.333, "spk_D": 0.667}

    result = merge_voice_weights(old_weights, old_ratio, new_weights)
    expected = {"spk_A": 0.24, "spk_B": 0.36, "spk_C": 0.133, "spk_D": 0.267}

    assert_weights_equal(result, expected, tolerance=0.001)
    assert abs(sum(result.values()) - 1.0) < 0.001  # 总和为1
```

### 手动测试清单

**界面测试：**
- [ ] 步骤引导清晰可见
- [ ] 权重输入框支持任意数字
- [ ] 权重显示实时更新
- [ ] 音频预览正常播放
- [ ] 保存功能正常工作

**工作流测试：**
- [ ] 从零开始创建流程完整
- [ ] 从现有产物创建流程完整
- [ ] 融合现有产物流程完整
- [ ] 语音合成流程完整

**响应式测试：**
- [ ] 移动端布局正确
- [ ] 平板端布局正确
- [ ] 桌面端布局正确
- [ ] 触摸操作友好

## 优化建议

### 基于测试结果的优化方向

1. **权重输入优化**：
   - 添加常用权重快捷按钮（1:1, 2:1, 3:1等）
   - 提供权重预设模板
   - 实时显示权重百分比

2. **工作流优化**：
   - 添加进度保存功能
   - 提供操作撤销功能
   - 增加批量操作支持

3. **性能优化**：
   - 权重计算防抖处理
   - 音频预览缓存机制
   - 懒加载非关键组件

4. **用户体验优化**：
   - 添加操作提示和帮助文档
   - 提供示例和模板
   - 优化错误提示信息

## 测试时间表

**第一阶段（1-2天）：核心功能测试**
- 权重计算逻辑验证
- 基本工作流测试
- 关键路径测试

**第二阶段（2-3天）：兼容性测试**
- 多设备响应式测试
- 浏览器兼容性测试
- 性能基准测试

**第三阶段（1-2天）：用户体验测试**
- 可用性测试
- 错误处理测试
- 优化建议整理

**第四阶段（1天）：回归测试**
- 修复验证
- 最终验收测试
- 文档更新

## 成功标准

**功能完整性：**
- 所有核心功能正常工作
- 权重计算100%准确
- 工作流引导清晰有效

**用户体验：**
- 新用户能在15分钟内完成首次创建
- 操
